<?php

use Laminas\Session\Container;

$sessionLogin = new Container('credo');
$config = $this->GlobalConfigHelper();
?>

<link rel="stylesheet" type="text/css" href="<?php echo $this->basePath('assets/lib/select2/css/select2.min.css'); ?>" />
<link rel="stylesheet" type="text/css" href="<?php echo $this->basePath('assets/css/dataTables.bootstrap.min.css'); ?>" />
<link rel="stylesheet" type="text/css" href="<?php echo $this->basePath('assets/css/daterangepicker-bs3.css'); ?>" />
<link rel="stylesheet" type="text/css" href="<?php echo $this->basePath('assets/css/leaflet.css'); ?>" />
<style>
	.auditPointName {
		color: #fff;
		margin: 0;

		min-width: 200px;
		vertical-align: top;
	}

	.auditPointName:hover {
		white-space: normal !important;
		overflow: visible;
		text-overflow: '';
	}

	.event a {
		background-color: #8eaffe !important;
		background-image: none !important;
		color: #ffffff !important;
		border-radius: 50%;
	}


	.highcharts-tooltip span {
		width: 250px;
		overflow: auto;
		white-space: normal !important;
	}

	.ms-parent {
		width: 100% !important;
	}

	.title h3 {
		display: inline;
		font-weight: 400;
	}

	/*multiselect*/
	/*.ui-state-hover, .ui-widget-content .ui-state-hover{color: #1c94c4;border: 1px solid #cccccc;background:none;}
.ui-state-active{color: #1c94c4;border: 1px solid #cccccc;background:none;}
.ui-multiselect-header{display: none;}
*/
	.widget-calendar .cal-container .cal-calendar .ui-datepicker table.ui-datepicker-calendar tr td a.ui-state-highlight {
		background: none !important;
		color: #888;
		border: none;
	}

	.limitBar {
		color: #555;
		background-color: #fff;
		background-image: none;
		border: 1px solid #ccc;
		border-radius: 4px;
		padding: 1px;
		vertical-align: middle;
	}

	.highcharts-legend {
		display: block !important;
	}


	.center {
		text-align: center;
	}
</style>
<link rel="stylesheet" href="<?php echo $this->basePath('assets/css/jquery.multiselect.css'); ?>" type="text/css" />
<script src="<?php echo $this->basePath('assets/js/jquery.js'); ?>" type="text/javascript"></script>
<script src="<?php echo $this->basePath('assets/js/jquery-ui.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo $this->basePath('assets/js/jquery.multiselect.js'); ?>" type="text/javascript"></script>

<!-- Hero Section -->
<section id="hero" class="hero section">

	<img src="assets/img/hero-bg-abstract.jpg" alt="" data-aos="fade-in" class="">

	<div class="container">
		<div class="row justify-content-center" data-aos="zoom-out">
			<div class="col-xl-7 col-lg-9 text-center">
				<h1><?= $this->translate('SPI RRT Dashboard'); ?></h1>
				<p><?= $this->translate('Data Repository and Analytics for Stepwise Process for Improving the Quality of HIV Rapid and Recency Testing (SPI-RRT)'); ?></p>
			</div>
		</div>
		<!-- <div class="text-center" data-aos="zoom-out" data-aos-delay="100">
			<a href="#about" class="btn-get-started">Get Started</a>
		</div> -->

		<div class="row gy-4 mt-5">
			<div class="col-md-6 col-lg-3" data-aos="zoom-out" data-aos-delay="100">
				<div class="icon-box">
					<div class="icon"><i class="bi bi-card-checklist"></i></div>
					<h4 class="title"><a href=""><?= $this->translate('Review Audits'); ?></a></h4>
					<p class="description"><?= $this->translate('Review audits and add additional comments.'); ?></p>
				</div>

			</div><!--End Icon Box -->

			<div class="col-md-6 col-lg-3" data-aos="zoom-out" data-aos-delay="200">
				<div class="icon-box">
					<div class="icon"><i class="bi bi-database-check"></i></div>
					<h4 class="title"><a href=""><?= $this->translate('Data Repository'); ?></a></h4>
					<p class="description"><?= $this->translate('Audit Data is centrally collected and available at any time.'); ?></p>
				</div>
			</div><!--End Icon Box -->

			<div class="col-md-6 col-lg-3" data-aos="zoom-out" data-aos-delay="300">
				<div class="icon-box">
					<div class="icon"><i class="bi bi-command"></i></div>
					<h4 class="title"><a href=""><?= $this->translate('Analytics'); ?></a></h4>
					<p class="description"><?= $this->translate('Use variety of charts and graphs to visualize data'); ?></p>
				</div>
			</div><!--End Icon Box -->

			<div class="col-md-6 col-lg-3" data-aos="zoom-out" data-aos-delay="400">
				<div class="icon-box">
					<div class="icon"><i class="bi bi-cloud-download"></i></div>
					<h4 class="title"><a href=""><?= $this->translate('Data Export'); ?></a></h4>
					<p class="description"><?= $this->translate('Export to PDF or Excel for records and further analysis.'); ?></p>
				</div>
			</div><!--End Icon Box -->

		</div>
	</div>

</section><!-- /Hero Section -->

<!-- About Section -->
<section id="about" class="about section ">
	<div class="container">
		<div class="row gy-4" style="margin-bottom:10px;clear:both;">
			<div class="col-md-12">
				<div class="widget" style="max-height:1000px;">
					<p><?= $this->translate('To assist ministries of health and national programs, a Stepwise Process for Improving the Quality of HIV Rapid and Recency Testing (SPI-RRT) checklist has been developed. The checklist provides guidance on quality assurance (QA) practices for sites using HIV rapid tests to diagnose HIV infection and for sites using the rapid test for recent infection (RTRI) for HIV-1 recent infection surveillance. The SPI-RRT checklist sets minimum standards for all HIV RT/RTRI testing points and provides guidelines for continuous quality improvement (CQI).'); ?></p>
					<img src="<?php echo $this->basePath('assets/img/spirrt-1.png'); ?>" style="border-radius:15px;height:300px;margin:0 auto 20px auto;display:block;box-shadow: 1px 2px 10px #aaa;" />
					<p style="text-align:center;font-size:0.9em;color:#666;margin-top:-1em;font-style:italic;"><?= $this->translate('SPI-RRT Audit Tools and Certification Levels'); ?></p>
					<img src="<?php echo $this->basePath('assets/img/spirrt-2.jpg'); ?>" style="border-radius:15px;height:300px;margin:0 auto 20px auto;display:block;box-shadow: 1px 2px 10px #aaa;" />
					<p style="text-align:center;font-size:0.9em;color:#666;margin-top:-1em;font-style:italic;"><?= $this->translate('SPI-RRT Audit Techniques'); ?></p>
					<p><?= $this->translate('Working through the SPI-RRT Checklist will enable the individuals in charge of the HIV RRT/RTRI testing points and facilities to recognize quality gaps and shortcomings, identify areas for improvement and where additional resources may be needed to achieve national certification. Using the SPI-RRT checklist, the HIV rapid and recency testing site audits are intended to be effective means to:'); ?></p>
					<ul style="padding-left:20px;">
						<li><?= $this->translate('determine if a testing facility is providing accurate and reliable results.'); ?></li>
						<li><?= $this->translate('determine if HIV RT/RTRI testing facilities are well-managed and is adhering to quality practices.'); ?></li>
						<li><?= $this->translate('identify areas for improvement.'); ?></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</section><!-- /About Section -->

<!-- Clients Section -->
<section id="clients" class="clients section light-background">
	<div class="container" data-aos="fade-up">
		<div class="row gy-4">
			<div class="col-md-12">
				<div class="widget">
					<div class="widget-head">
						<span class="title">
							<h3><?= $this->translate('Latest Audits'); ?></h3>
							<hr>
						</span>
					</div>
					<div class="chart-container">
						<div id="audit-points-barchart" style="width:100%;height:345px"></div>
					</div>
				</div>
			</div>

		</div>
	</div>
</section><!-- /Clients Section -->

<!-- Clients Section -->
<section id="clients" class="clients section">
	<div class="container" data-aos="fade-up">
		<div class="row">
			<div class="col-md-12" id="righter">
				<div class="widget widget-map">

					<div class="widget-head">
						<div class="title row">
							<div class="col-lg-12 col-sm-12 col-md-12 col-xs-12">
								<h3><?= $this->translate('Audit Locations'); ?></h3>
								<hr>
							</div>
						</div>
					</div>
					<div id="auditLocations" style="height:500px;max-height:500px;">
					</div>
				</div>
			</div>
		</div>
	</div>
</section><!-- /Clients Section -->

<script src="<?php echo $this->basePath('assets/js/maplace.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo $this->basePath('assets/lib/select2/js/select2.min.js'); ?>" type="text/javascript"></script>


<script src="<?php echo $this->basePath('assets/js/highcharts.js'); ?>"></script>
<script src="<?php echo $this->basePath('assets/js/highcharts-more.js'); ?>"></script>
<script src="<?php echo $this->basePath('assets/js/pattern-fill.js'); ?>"></script>

<script type="text/javascript" src="<?php echo $this->basePath('assets/js/jquery.dataTables.min.js'); ?>"></script>
<script type="text/javascript" src="<?php echo $this->basePath('assets/js/dataTables.bootstrap.min.js'); ?>"></script>
<script src="<?php echo $this->basePath('assets/js/daterangepicker.js'); ?>" type="text/javascript"></script>
<script type="text/javascript" src="<?php echo $this->basePath('assets/js/leaflet.js'); ?>"></script>
<script type="text/javascript">
	let color1 = "red";
	let color2 = "orange";
	let color3 = "yellow";
	let color4 = "#8DD63E";
	let color5 = "#528A16";

	//Get the template css colors into js vars
	function getColor(c) {
		let tmp = $("<div>", {
			class: c
		}).appendTo("body");
		let color = tmp.css("background-color");
		tmp.remove();

		return color;
	}

	let colors = {};
	colors.primary = getColor('clr-primary');
	colors.success = getColor('clr-success');
	colors.info = getColor('clr-info');
	colors.warning = getColor('clr-warning');
	colors.danger = getColor('clr-danger');
	colors.alt1 = getColor('clr-alt1');
	colors.alt2 = getColor('clr-alt2');
	colors.alt3 = getColor('clr-alt3');
	colors.alt4 = getColor('clr-alt4');

	function bar_chart() {

		<?php

		$counter = 0;
		$barData = [];
		$volumeData = [];
		$labNameData = [];
		foreach ($allSubmissions as $row) {
			if ($counter == 20) break;
			if ($row['AUDIT_SCORE_PERCENTAGE'] < 40) {
				$color = '#FF0000';
			} else if ($row['AUDIT_SCORE_PERCENTAGE'] >= 40 && $row['AUDIT_SCORE_PERCENTAGE'] < 60) {
				$color = '#FFA500';
			} else if ($row['AUDIT_SCORE_PERCENTAGE'] >= 60 && $row['AUDIT_SCORE_PERCENTAGE'] < 80) {
				$color = '#FFFF00';
			} else if ($row['AUDIT_SCORE_PERCENTAGE'] >= 80 && $row['AUDIT_SCORE_PERCENTAGE'] < 90) {
				$color = '#8DD63E';
			} else if ($row['AUDIT_SCORE_PERCENTAGE'] >= 90) {
				$color = '#528A16';
			}

			$barData[] = "{ y : " . round($row['AUDIT_SCORE_PERCENTAGE'], 2) . ", color : '" . $color . "' }";
			$volumeData[] = (isset($row['avgMonthTesting']) ? $row['avgMonthTesting'] : 0);
			$labNameData[] = ("'Date : " . $this->humanReadableDateFormat($row['assesmentofaudit']) . "<br>' + ' ' + 'Facility Name : " . addslashes($row['facilityname']) . " <br> Testing Point Name : " . "<br>'");
			$counter++;
		}
		?>

		$('#audit-points-barchart').highcharts({
			chart: {
				zoomType: 'xy'
			},
			title: {
				text: ''
			},
			subtitle: {
				text: ''
			},
			xAxis: {
				categories: [<?php echo implode(",", $labNameData); ?>],
				crosshair: true,
				labels: {
					enabled: false
				}
			},
			legend: {
				enabled: true
			},
			yAxis: [

				{ // Primary yAxis
					labels: {
						format: '{value}%',
						style: {
							color: Highcharts.getOptions().colors[1]
						}
					},
					title: {
						text: '<?= $this->translate('Audit score in %'); ?>',
						style: {
							color: Highcharts.getOptions().colors[1]
						}
					},
					min: 0,
					max: 100
				}, { // Secondary yAxis
					title: {
						text: '<?= $this->translate('Testing Volume'); ?>',
						style: {
							color: Highcharts.getOptions().colors[0]
						}
					},
					labels: {
						format: '{value}',
						style: {
							color: Highcharts.getOptions().colors[0]
						}
					},
					opposite: true
				}
			],
			tooltip: {
				headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
				pointFormat: '<tr><td style="padding:0;font-size:10px">{series.name}: </td>' +
					'<td style="padding:0;font-size:10px">{point.y:.2f}</td></tr>',
				footerFormat: '</table>',
				shared: true,
				useHTML: true
			},
			plotOptions: {
				column: {
					pointPadding: 0,
					borderWidth: 0
				}
			},
			series: [{
				name: '<?= $this->translate('Audit Score Percentage'); ?>',
				data: [<?php echo implode(",", $barData); ?>],
				stack: 'score',
				type: 'column',
				tooltip: {
					valueSuffix: ' %'
				}
			}, {
				name: '<?= $this->translate('Testing Volume'); ?>',
				type: 'column',
				data: [<?php echo implode(",", $volumeData); ?>],
				stack: 'volume',
				color: {
					pattern: "<?php echo $this->basePath('assets/img/pattern3.png'); ?>",
					width: 6,
					height: 6
				},
				yAxis: 1,
				tooltip: {
					valueSuffix: ' <?= $this->translate('Tests'); ?>'
				}
			}]
		});

	}

	function getspiRTv3() {
		$.post("<?php echo $this->url('spi-v3-form', array('action' => 'spirtv3-datewise')); ?>",
			function(data) {
				$("#dateRangePickerValue").html(data);
			});
	}

	function getTestingVolumeValue() {
		$.post("<?php echo $this->url('spi-v3-form', array('action' => 'testing-volume-datewise')); ?>",
			function(data) {

			});
	}

	// function getAuditWorstDetails() {

	// 	limitBar = $("#limitBar").val();

	// 	$.post("<?php echo $this->url('spi-v3-form', array('action' => 'worst-performance')); ?>", {
	// 			limitBar: limitBar
	// 		},
	// 		function(data) {
	// 			$("#zeroCountChart").html(data);
	// 		});

	// }

	function getAuditDetails() {

		$.post("<?php echo $this->url('homeAuditPerformance', array('action' => 'audit-performance')); ?>",
			function(data) {
				$("#radarChart").html(data);
			});

	}

	function getAuditLocationDetails() {
		$.post("<?php echo $this->url('homeAuditLocations'); ?>",
			function(data) {
				$("#auditLocations").html(data);
			});
	}

	//Calendar Widget
	function calendar_widget() {
		let widget = $(".widget-calendar");
		let calNotes = $(".cal-notes", widget);
		let calNotesDay = $(".day", calNotes);
		let calNotesDate = $(".date", calNotes);

		//Calculate the weekday name
		let d = new Date();
		let weekday = new Array(7);
		weekday[0] = "Sunday";
		weekday[1] = "Monday";
		weekday[2] = "Tuesday";
		weekday[3] = "Wednesday";
		weekday[4] = "Thursday";
		weekday[5] = "Friday";
		weekday[6] = "Saturday";

		var weekdayName = weekday[d.getDay()];

		calNotesDay.html(weekdayName);

		//Calculate the month name
		var month = new Array();
		month[0] = "January";
		month[1] = "February";
		month[2] = "March";
		month[3] = "April";
		month[4] = "May";
		month[5] = "June";
		month[6] = "July";
		month[7] = "August";
		month[8] = "September";
		month[9] = "October";
		month[10] = "November";
		month[11] = "December";

		var monthName = month[d.getMonth()];
		var monthDay = d.getDate();

		calNotesDate.html(monthName + " " + monthDay);

		if (typeof jQuery.ui != 'undefined') {


			<?php

			$eventDatesArray = [];
			$eventCount = [];
			foreach ($allSubmissions as $row) {
				$humanDate = $this->humanReadableDateFormat($row['assesmentofaudit']);
				$eventDatesArray[] = "'" . $humanDate . "'";
				if (isset($eventCount[$humanDate])) {
					$eventCount[$humanDate] = $eventCount[$humanDate] + 1;
				} else {
					$eventCount[$humanDate] = 1;
				}
			}

			$countJson = json_encode($eventCount);

			if ($countJson != null && $countJson != "") {
			?>
				var countJson = <?php echo $countJson; ?>
			<?php
			} else {
			?>
				var countJson = null;
			<?php
			}
			?>


			var eventDates = [<?php echo implode(",", $eventDatesArray); ?>];



			$(".ui-datepicker").datepicker({
				dateFormat: 'dd-M-yy',
				onSelect: function(s, o) {
					var sd = new Date(s);
					var weekdayName = weekday[sd.getDay()];
					var monthName = month[sd.getMonth()];
					var monthDay = sd.getDate();
					calNotesDay.html(weekdayName);
					calNotesDate.html(monthName + " " + monthDay);
				},
				beforeShowDay: function(date) {
					hdate = $.datepicker.formatDate('dd-M-yy', date);
					if ($.inArray(hdate, eventDates) > -1) {
						return [true, "event", "Audits on this date : " + countJson[hdate]];
					} else {
						return [true, '', "No recorded audits on this date"];
					}
				}
			});
		}
	}

	function getdata() {
		var Base64 = {
			_keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
			encode: function(e) {
				var t = "";
				var n, r, i, s, o, u, a;
				var f = 0;
				e = Base64._utf8_encode(e);
				while (f < e.length) {
					n = e.charCodeAt(f++);
					r = e.charCodeAt(f++);
					i = e.charCodeAt(f++);
					s = n >> 2;
					o = (n & 3) << 4 | r >> 4;
					u = (r & 15) << 2 | i >> 6;
					a = i & 63;
					if (isNaN(r)) {
						u = a = 64
					} else if (isNaN(i)) {
						a = 64
					}
					t = t + this._keyStr.charAt(s) + this._keyStr.charAt(o) + this._keyStr.charAt(u) + this._keyStr.charAt(a)
				}
				return t
			},
			decode: function(e) {
				var t = "";
				var n, r, i;
				var s, o, u, a;
				var f = 0;
				e = e.replace(/[^A-Za-z0-9+/=]/g, "");
				while (f < e.length) {
					s = this._keyStr.indexOf(e.charAt(f++));
					o = this._keyStr.indexOf(e.charAt(f++));
					u = this._keyStr.indexOf(e.charAt(f++));
					a = this._keyStr.indexOf(e.charAt(f++));
					n = s << 2 | o >> 4;
					r = (o & 15) << 4 | u >> 2;
					i = (u & 3) << 6 | a;
					t = t + String.fromCharCode(n);
					if (u != 64) {
						t = t + String.fromCharCode(r)
					}
					if (a != 64) {
						t = t + String.fromCharCode(i)
					}
				}
				t = Base64._utf8_decode(t);
				return t
			},
			_utf8_encode: function(e) {
				e = e.replace(/rn/g, "n");
				var t = "";
				for (var n = 0; n < e.length; n++) {
					var r = e.charCodeAt(n);
					if (r < 128) {
						t += String.fromCharCode(r)
					} else if (r > 127 && r < 2048) {
						t += String.fromCharCode(r >> 6 | 192);
						t += String.fromCharCode(r & 63 | 128)
					} else {
						t += String.fromCharCode(r >> 12 | 224);
						t += String.fromCharCode(r >> 6 & 63 | 128);
						t += String.fromCharCode(r & 63 | 128)
					}
				}
				return t
			},
			_utf8_decode: function(e) {
				var t = "";
				var n = 0;
				var r = c1 = c2 = 0;
				while (n < e.length) {
					r = e.charCodeAt(n);
					if (r < 128) {
						t += String.fromCharCode(r);
						n++
					} else if (r > 191 && r < 224) {
						c2 = e.charCodeAt(n + 1);
						t += String.fromCharCode((r & 31) << 6 | c2 & 63);
						n += 2
					} else {
						c2 = e.charCodeAt(n + 1);
						c3 = e.charCodeAt(n + 2);
						t += String.fromCharCode((r & 15) << 12 | (c2 & 63) << 6 | c3 & 63);
						n += 3
					}
				}
				return t
			}
		}

		value = $("#auditRndNoLocations").val();
		if (value != null) {
			var encodedString = Base64.encode("'" + value + "'");
			window.open('/common/audit-locations?id=' + encodedString, '_blank');
		} else {
			window.open('/common/audit-locations', '_blank');
		}
	}
	$(document).ready(function() {
		//initialize the javascript

		$(".select2").select2({
			width: '100%',
			placeholder: '',
			allowClear: true,
			tags: false
		});



		getAuditDetails();

		bar_chart();
		//zeroCountsBarChart();
		//getAuditWorstDetails();

		getAuditLocationDetails();



		$("#auditRndNo").multipleSelect({
			placeholder: '<?= $this->translate('Audit round(s)'); ?>',
			width: '31%',
			minimumCountSelected: '2'
		});
		$("#auditRndNoLocations").multipleSelect({
			placeholder: '<?= $this->translate('Select Audit round(s)'); ?>',
			width: '30%',
			minimumCountSelected: '2'
		});
	});



	function approveStatus(id) {
		conf = confirm("Are you sure you want to approve this audit ?");
		if (conf) {
			$.post("<?php echo $this->url('spi-v3-form', ['action' => 'approve-status']); ?>", {
					id: id
				},
				function(data) {
					if (data > 0) {
						alert("Audit updated successfully");
						window.location.href = window.location;
					}

				});
		}
	}

	$(function() {
		<?php

		$counter = 0;
		$barData = [];
		$volumeData = [];
		$labNameData = [];
		$testerData = [];
		$levelData = [];

		foreach ($testingVolume as $row) {
			if ($counter == 10) {
				break;
			}
			$percentage = $row['AUDIT_SCORE_PERCANTAGE'] ?? $row['AUDIT_SCORE_PERCENTAGE'];
			if ($percentage < 40) {
				$color = '#FF0000';
				$level = 0;
			} else if ($percentage >= 40 && $percentage < 60) {
				$color = '#FFA500';
				$level = 1;
			} else if ($percentage >= 60 && $percentage < 80) {
				$color = '#FFFF00';
				$level = 2;
			} else if ($percentage >= 80 && $percentage < 90) {
				$color = '#8DD63E';
				$level = 3;
			} else if ($percentage >= 90) {
				$color = '#528A16';
				$level = 4;
			}

			$levelData[] = "{ y : $level, color : '$color' }";
			$volumeData[] = $row['avgMonthTesting'] ?? 0;
			$testerData[] = $row['NumberofTester'] ?? 0;
			$labNameData[] = "'Date : " . $this->humanReadableDateFormat($row['assesmentofaudit']) . "<br>'";
			$counter++;
		}
		?>


		$('#volumeChart').highcharts({
			chart: {
				zoomType: 'xy'
			},
			title: {
				text: ''
			},
			subtitle: {
				text: ''
			},
			xAxis: [{
				categories: [<?php echo implode(",", $labNameData); ?>],
				crosshair: true,
				labels: {
					enabled: false
				}
			}],
			yAxis: [{
				labels: {
					format: '{value}',
					style: {
						color: Highcharts.getOptions().colors[1]
					}
				},
				title: {
					text: '<?= $this->translate('No. of Testers'); ?>',
					style: {
						color: Highcharts.getOptions().colors[1]
					}
				},
				opposite: true

			}, { // Secondary yAxis
				gridLineWidth: 0,
				title: {
					text: 'Level',
					style: {
						color: Highcharts.getOptions().colors[0]
					}
				},
				labels: {
					format: '{value}',
					style: {
						color: Highcharts.getOptions().colors[0]
					}
				},
				min: 0,
				max: 4,
				opposite: true

			}, { // Tertiary yAxis
				gridLineWidth: 0,
				title: {
					text: '<?= $this->translate('Testing Volume'); ?>',
					style: {
						color: Highcharts.getOptions().colors[1]
					}
				},
				labels: {
					format: '{value}',
					style: {
						color: Highcharts.getOptions().colors[1]
					}
				}
			}],
			tooltip: {
				shared: true
			},
			plotOptions: {
				column: {
					pointPadding: 0,
					borderWidth: 0
				},
			},
			legend: {
				enabled: true
			},
			series: [{
				name: '<?= $this->translate('Testing Volume'); ?>',
				type: 'column',
				yAxis: 2,
				data: [<?php echo implode(",", $volumeData); ?>],
				color: {
					pattern: "<?php echo $this->basePath('assets/img/pattern3.png'); ?>",
					width: 6,
					height: 6
				},
				tooltip: {
					valueSuffix: ' <?= $this->translate('Tests'); ?>'
				}

			}, {
				name: '<?= $this->translate('Testers'); ?>',
				type: 'column',
				data: [<?php echo implode(",", $testerData); ?>],
				tooltip: {
					valueSuffix: ' <?= $this->translate('Tests'); ?>'
				}

			}, {
				name: '<?= $this->translate('Level'); ?>',
				type: 'column',
				yAxis: 1,
				data: [<?php echo implode(",", $levelData); ?>],
				tooltip: {
					valueSuffix: ' '
				},
				color: '#a058c4',

			}]
		});
		<?php
		$eventDatesArray = [];
		$eventCount = [];
		foreach ($allSubmissions as $row) {
			$humanDate = $this->humanReadableDateFormat($row['assesmentofaudit']);
			$eventDatesArray[] = "'" . $humanDate . "'";
			if (isset($eventCount[$humanDate])) {
				$eventCount[$humanDate] = $eventCount[$humanDate] + 1;
			} else {
				$eventCount[$humanDate] = 1;
			}

			if (count($eventCount) >= 40) {
				break;
			}
		}

		$eventDatesArray = array_unique($eventDatesArray);


		?>

		$('#auditDates').highcharts({
			chart: {
				type: 'column'
			},
			title: {
				text: ''
			},
			subtitle: {
				text: ''
			},
			xAxis: {
				categories: [<?php echo implode(",", $eventDatesArray); ?>],
				crosshair: true
			},
			yAxis: {
				min: 0,
				title: {
					text: '<?= $this->translate('Audit Counts'); ?>'
				}
			},
			legend: {
				enabled: false
			},
			tooltip: {
				headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
				pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
					'<td style="padding:0"><b>{point.y:.0f}</b></td></tr>',
				footerFormat: '</table>',
				shared: true,
				useHTML: true
			},
			plotOptions: {
				column: {
					pointPadding: 0.2,
					borderWidth: 0
				}
			},
			series: [{
				name: '<?= $this->translate('Audit Counts'); ?>',
				data: [<?php echo implode(",", $eventCount); ?>]

			}]
		});


	});
</script>
